name: Simple Todos
version: "1.0" 
servers:
  - name: server
    type: http
    env:
      production: 
        host: todos.looptype.com
      development: 
        host: localhost
        port: 8080
    packages:
      - static
      - client
      - server
    locations:
      - location: /
        type: nodejs
        main: /server/index.js
      - location: /static
        type: static
        path: /static
  - name: auth-server
    type: http
    env:
      production: 
        host: todos-auth.looptype.com
      development:
        host: localhost
        port: 8081
    packages:
      - auth-server
    locations:
      - location: /
        type: nodejs
        main: /server/index.js        
builds:
  static:
    type: copy
    dest: /static
  client:
    type: typescript
    bundle: yes
    output: /static/client.js
  server:
    type: typescript
    output: /server  
    connections:
      - type: webdisk
        path: ./disk.ts
        disk: todos
      - type: postgres
        path: ./db.ts
        db: todosdb
      - type: redis
        path: ./redis.ts
        db: todoscache
  auth-server:
    type: typescript
    output: /auth-server  
    connections:
      - type: postgres
        path: ./db.ts
        db: authdb
