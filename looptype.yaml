name: Simple Todos
webserver:
  app:
    paths:
      - location: /
        proxy: 
      - location: /static
        root: /dist/static
    env:
      todos_production:
        domain: todos.looptype.com
      todos_dev:
        domain: localhost
        port: 8080
        targetPort: 8080
packages:
  static:
    build:
      type: copy
      dest: /dist/static
  client:
    build:
      type: typescript
      bundle: yes
      output: /dist/static/client.js
  server:
    build: 
      type: typescript
      output: /dist/server  
    run:
      type: nodejs
      main: /dist/server
    connections:
      - type: webdisk
        path: ./disk.ts
        disk: todos
      - type: postgres
        path: ./db.ts
        db: todosdb
      - type: redis
        path: ./redis.ts
        db: todoscache
    ports:
      - type: TCP
        port: 8080
  auth:
    build:
      type: typescript
      output: /dist/auth  
    run:
      type: nodejs
      main: /dist/auth
    connections:
      - type: postgres
        path: ./db.ts
        db: authdb
    ports:
      - type: TCP
        port: 8080
      
